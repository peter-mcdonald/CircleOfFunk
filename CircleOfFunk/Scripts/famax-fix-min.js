function loadFamax() { $("#famax").append('<div id="famax-header"><div id="famax-stat-holder"></div></div>'); for (var a = "", e = 100 / famaxColumns, t = 1; famaxColumns >= t; t++) a += '<div id="famax-video-list-div' + t + '" style="width:' + e + '%;" class="famax-video-list-div"></div>'; $("#famax").append('<div id="famax-encloser">' + a + '<div class="load-more-wrapper"><span class="load-more" id="load-more"> Load More..</span></div></div>'), $("#load-more").click(function () { $("#load-more").text("loading.."), loadMore() }), $("#famax").append('<div id="famax-lightbox"><div id="picasa-lightbox-wrapper"><div id="picasa-lightbox-image"><img id="picasa-img-lightbox" src=""><iframe id="famax-video-lightbox" width="640" height="360" src="" frameborder="0" allowfullscreen></iframe></div><div id="picasa-lightbox-helper"></div></div></div>'), $("#famax-lightbox").click(function () { $("#picasa-img-lightbox").attr("src", ""), $("#famax-video-lightbox").attr("src", ""), $("#famax-lightbox").hide(), $("#famax-img-lightbox").hide(), $("#famax-video-lightbox").hide() }), $("#famax-lightbox").hide(), $("#famax-img-lightbox").hide(), $("#famax-video-lightbox").hide() } function prepareFamax() { famaxPageName = facebookPageUrl.substring(facebookPageUrl.lastIndexOf("/") + 1), famaxPageId = getIdFromName(famaxPageName), loadFamax(); var a = "https://graph.facebook.com/fql?q=SELECT+post_id,actor_id,target_id,message,description,attachment,created_time,updated_time+FROM+stream+WHERE+source_id=" + famaxPageId + "+AND+actor_id=" + famaxPageId + "+ORDER+BY+created_time+DESC&access_token=" + fbAccessToken; getPageDetails(a); var a = "http://graph.facebook.com/" + famaxPageId; getPageInfo(a) } function getPageDetails(a) { fqlPending = 1, $.ajax({ url: a, type: "GET", async: !0, cache: !0, dataType: "jsonp", success: function (a) { showFamax(a) }, error: function (a) { alert(a) }, beforeSend: setHeader }) } function getPageInfo(a) { $.ajax({ url: a, type: "GET", async: !0, cache: !0, dataType: "jsonp", success: function (a) { showInfo(a) }, error: function (a) { alert(a) }, beforeSend: setHeader }) } function showFamax(a) { for (var e, t, i, o, d, n, r, s, c, m, f, l, h, g = a.data, p = [], x = 0; x < g.length; x++) if (e = g[x].post_id, t = g[x].actor_id, i = g[x].message, o = g[x].description, n = "https://graph.facebook.com/" + t + "/picture", r = g[x].attachment, attachment_name = r.name, s = r.media, created_time = g[x].created_time, null != i && "" != i && "undefined" != i) { if (null != s && "" != s && "undefined" != s) for (var u = 0; u < s.length; u++) m = s[u].type, f = s[u].src, null != m ? "video" == m ? (l = s[u].video.source_url, width = 0, height = 0) : "photo" == m ? (l = s[u].href, width = s[u].photo.width, height = s[u].photo.height) : (l = s[u].href, width = 0, height = 0) : l = null, c = { type: m, src: f, href: l, height: height, width: width }, p.push(c); else p = null, m = null, f = null, l = null; h = { post_id: e, actor_id: t, actor_pic_src: n, message: i, description: o, actor_name: d, fbAttachmentList: p, created_time: created_time, attachment_name: attachment_name }, showPost(h), p = [] } fqlPending = 0, famaxLastCreatedTime = created_time, $("#load-more").text("Load More..") } function showPost(a) { var e, t, i = 0, o = a.fbAttachmentList, d = (a.attachment_name, ""), n = a.message; if (null != n && "" != n && "undefined" != n) { var r, s, c, m = "", f = n.length; if (-1 != n.indexOf("http://")) { for (r = n.indexOf("http://"), s = n.charAt(r - 1), c = r; n.charAt(c) != s && (m += n.charAt(c++), !(" " == n.charAt(c) || c >= f || "\n" == n.charAt(c) || "\r\n" == n.charAt(c))) ;); n = n.replace(m, '<a target="_blank" href="' + m + '">' + m + "</a>") } else if (-1 != n.indexOf("https://")) { for (r = n.indexOf("https://"), s = n.charAt(r - 1), c = r; n.charAt(c) != s && (m += n.charAt(c++), !(" " == n.charAt(c) || c >= f || "\n" == n.charAt(c) || "\r\n" == n.charAt(c))) ;); n = n.replace(m, '<a target="_blank" href="' + m + '">' + m + "</a>") } else if (-1 != n.indexOf("www.")) { for (r = n.indexOf("www."), s = n.charAt(r - 1), c = r; n.charAt(c) != s && (m += n.charAt(c++), !(" " == n.charAt(c) || c >= f || "\n" == n.charAt(c) || "\r\n" == n.charAt(c))) ;); n = n.replace(m, '<a target="_blank" href="' + m + '">' + m + "</a>") } } if (null != o && "" != o && "undefined" != o) for (var l = 0; l < o.length; l++) attachment_type = o[l].type, e = o[l].src, attachment_href = o[l].href, 0 == l ? (-1 != e.indexOf("_s.") && (e = e.replace("_s.", "_n.")), "photo" == attachment_type ? (i = o[l].width / o[l].height, t = '<div id="' + a.post_id + '" data-picSrc="' + e + '" class="famax-pic-tnail" style="filter: progid:DXImageTransform.Microsoft.AlphaImageLoader( src=\'' + e + "', sizingMethod='scale'); background-image:url('" + e + "')\"></div>") : "link" == attachment_type ? t = '<div class="famax-link-tnail" style="width:100%;text-align:center;"><a target="_blank" href="' + attachment_href + '"><i class="_1y4" style="background: url(\'./Images/famax_link.png\') no-repeat 0 0;"></i><img  class="link-img" id="' + a.post_id + '" src="' + e + '"></a></div>' : "video" == attachment_type && (t = '<div class="famax-video-tnail" data-videoSrc="' + attachment_href + '" style="width:100%;text-align:center;"><i class="_1y4" style="background: url(\'./Images/famax_video.png\') no-repeat 0 0;"></i><img class="video-img"  id="' + a.post_id + '" src="' + e + '"></div>')) : l > 0 && "photo" == attachment_type && (d += '<div class="famax-playlist-sidebar-video" data-picSrc="' + e + '" style="background-image:url(\'' + e + "')\"></div>"); else t = "", d = ""; var h = getNextFamaxColumn(); if (null != d && "undefined" != d && "" != d && (d = '<div class="famax-pic-train" id="famax-pic-train-' + a.post_id + '">' + d + "</div>"), $("#famax-video-list-div" + h).append('<div class="famax-video-tnail-box">' + t + d + '<span class="famax-video-list-title">' + n + "</span><br/></div>"), $(".famax-pic-tnail").click(function () { showPicLightbox(this.getAttribute("data-picSrc")) }), $(".famax-video-tnail").click(function () { showVideoLightbox(this.getAttribute("data-videoSrc")) }), $(".famax-playlist-sidebar-video").click(function () { var a = this.getAttribute("data-picSrc"); -1 != a.indexOf("_s.") && (a = a.replace("_s.", "_n.")), showPicLightbox(a) }), 0 != i) { var g = $("#" + a.post_id).css("width"); g = g.substring(0, g.indexOf("px")); var p = g / i; $("#" + a.post_id).css({ height: p + "px" }) } } function getIdFromName(a) { var e, t = "https://graph.facebook.com/" + a; return $.ajax({ type: "GET", url: t, async: !1, beforeSend: function (a) { a && a.overrideMimeType && a.overrideMimeType("application/j-son;charset=UTF-8") }, dataType: "json", success: function (a) { e = a.id } }), e } function setHeader(a) { a && a.overrideMimeType && a.overrideMimeType("application/j-son;charset=UTF-8") } function loadMore() { if (!fqlPending && null != famaxLastCreatedTime && "" != famaxLastCreatedTime && "undefined" != famaxLastCreatedTime) { var a = "https://graph.facebook.com/fql?q=SELECT+post_id,actor_id,target_id,message,description,attachment,created_time,updated_time+FROM+stream+WHERE+source_id=" + famaxPageId + "+AND+created_time<" + famaxLastCreatedTime + "+ORDER+BY+created_time+DESC+LIMIT+10&access_token=" + fbAccessToken; famaxLastCreatedTime = "", famaxLastCreatedTime = getPageDetails(a) } } function getNextFamaxColumn() { for (var a = $("#famax-video-list-div1").height(), e = 0, t = 1, i = 1; famaxColumns >= i; i++) e = $("#famax-video-list-div" + i).height(), a > e && (a = e, t = i); return t } function showPicLightbox(a) { $("#famax-img-lightbox").show(), $("#famax-lightbox").show(), showLoadingInLightbox(), setTimeout(function () { $("#picasa-img-lightbox").attr("src", a) }, 10) } function showVideoLightbox(a) { $("#famax-video-lightbox").show(), console.log(a), $("#famax-lightbox").show(), setTimeout(function () { $("#famax-video-lightbox").attr("src", a) }, 10) } function showLoadingInLightbox() { $("#picasa-img-lightbox").attr("src", ""), $("#picasa-img-lightbox").attr("src", pathToLoadingImage) } function showInfo(a) { var e = a.name, t = "https://graph.facebook.com/" + a.id + "/picture", i = a.likes, o = a.talking_about_count, d = a.link; $("#famax-header").append('<a target="_blank" href="' + d + '"><img style="vertical-align:middle; height:60px; margin:15px; display:inline-block;" src="' + t + '"/>' + e + "</a>&nbsp;&nbsp;&nbsp;"), $("#famax-header").append('<div class="famax-like-wrapper"><iframe src="http://www.facebook.com/plugins/like.php?href=http%3A%2F%2Fwww.facebook.com%2F' + famaxPageId + '&amp;send=false&amp;layout=box_count&amp;width=200&amp;show_faces=false&amp;font&amp;colorscheme=light&amp;action=like&amp;height=90&amp;appId=384323531651193" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:100px; height:70px;" allowTransparency="true"></iframe></div>'), $("#famax-stat-holder").append('<div class="famax-stat"><span class="famax-stat-count">' + getReadableNumber(o) + '</span><br/>Talking About Us</div><div class="famax-stat"><span class="famax-stat-count">' + getReadableNumber(i) + "</span><br/> Likes </div>") } function getReadableNumber(a) { if (null == a || "" == a || "undefined" == a) return "?"; a = a.toString(); for (var e = "", t = 0, i = a.length; i >= 0; i--) e += a.charAt(i), 3 == t && i > 0 ? (t = 1, e += ",") : t++; return e.split("").reverse().join("") } var facebookPageUrl = "https://www.facebook.com/pages/Circle-Of-Funk/200734783279825", fbAccessToken = "460135344048321|44473b4be8cdf726e70daaff38068ab8", famaxWidgetWidth = 800, pathToLoadingImage = "./Images/Loader/famax-loader.gif", famaxColumns = 3; if (null == pathToLoadingImage || "" == pathToLoadingImage || "undefined" == pathToLoadingImage) var pathToLoadingImage = ""; if (null == famaxWidgetWidth || "" == famaxWidgetWidth || "undefined" == famaxWidgetWidth) var famaxWidgetWidth = 640; if ("undefined" != typeof famaxWidgetHeight && null != famaxWidgetHeight && "" != famaxWidgetHeight && "undefined" != famaxWidgetHeight && $("html > head").append("<style>#famax{overflow-y:auto;height:" + famaxWidgetHeight + "px;}</style>"), null == famaxColumns || "" == famaxColumns || "undefined" == famaxColumns) var famaxColumns = 2; if (null == fbAccessToken || "" == fbAccessToken || "undefined" == fbAccessToken) var fbAccessToken = "460135344048321|44473b4be8cdf726e70daaff38068ab8"; var famaxPageId;